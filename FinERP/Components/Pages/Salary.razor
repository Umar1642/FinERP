@page "/salary"
@attribute [Authorize]
@rendermode InteractiveServer
@using FinERP.Models
@using Microsoft.EntityFrameworkCore
@using CultureInfo = System.Globalization.CultureInfo
@using FinERP.Data
@inject IDbContextFactory<FinERP.Data.AppDbContext> DbFactory

<MudText Typo="Typo.h3" GutterBottom="true">Salary Management</MudText>

<MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6">
    
    <MudTabPanel Text="Salaries">
        
<MudDataGrid T="FinERP.Models.Employee" 
             Items="@employees" 
             ReadOnly="false" 
             EditMode="DataGridEditMode.Form"
             Hover="true" 
             Dense="true" 
             Striped="true" 
             Bordered="true">
    <ToolBarContent>
        <MudText Typo="Typo.h6">Employee Records (@employees.Count)</MudText>
        <MudSpacer />
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="AddNewRow" StartIcon="@Icons.Material.Filled.Add">
            Add Employee
        </MudButton>
    </ToolBarContent>
    <Columns>
        <PropertyColumn Property="x => x.Id" Title="ID" />
        <PropertyColumn Property="x => x.Name" Title="Name" />
        <PropertyColumn Property="x => x.Department" Title="Dept" />
        <PropertyColumn Property="x => x.Role" Title="Role" />
        <PropertyColumn Property="x => x.HireDate" Title="Hire Date" format="d" />
        <PropertyColumn Property="x => x.SalaryUSD" Title="Salary" />
        <PropertyColumn Property="x => x.Region" Title="Region" />
        <PropertyColumn Property="x => x.Employment_Status" Title="Status" CellStyleFunc="@_cellStyleFunc" />
        <PropertyColumn Property="x => x.Manager_ID" Title="Manager ID" />
    </Columns>
</MudDataGrid>

    </MudTabPanel>
    <MudTabPanel Text="IMTD">
        
    </MudTabPanel>

</MudTabs>

@code {
    private List<Employee> employees = new();

    protected override async Task OnInitializedAsync()
    {
        using var context = DbFactory.CreateDbContext();
        employees = await context.Employees.ToListAsync();
        StateHasChanged();
    }

    private Func<Employee, string> _cellStyleFunc => x =>
    {
        string style = "";

        if (x.Employment_Status == "Active")
        {
            style += "background-color:#8CED8C";
        }
        else if (x.Employment_Status == "Probation")
        {
            style += "background-color:#EACE5D";
        }

        return style;
    };

    private void AddNewRow()
    {
        Console.Write("clickywicky");
    }
}