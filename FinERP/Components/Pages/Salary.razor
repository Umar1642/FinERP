@page "/salary"
@rendermode InteractiveServer
@using FinERP.Models
@using CultureInfo = System.Globalization.CultureInfo

<MudText Typo="Typo.h3" GutterBottom="true">Salary Management</MudText>

<MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6">
    
    <MudTabPanel Text="Salaries">
        
        <MudDataGrid T="FinERP.Models.Salary" Items="@salaries" ReadOnly="false" EditMode="DataGridEditMode.Form">
            <ToolBarContent>
                <MudText Typo="Typo.h6">Salary Records</MudText>
                <MudSpacer />
                <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="AddNewRow" StartIcon="@Icons.Material.Filled.Add">
                    Add Salary
                </MudButton>
            </ToolBarContent>
            
            <Columns>
                <PropertyColumn Property="x => x.Date" Title="Date" Format="d" />
                <PropertyColumn Property="x => x.EmployeeName" Title="Employee Name" />
                <PropertyColumn Property="x => x.Amount" Title="Amount" Format="c" Culture="@CultureInfo.GetCultureInfo("en-US")"/>
                
                <TemplateColumn>
                    <CellTemplate>
                        <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Outlined.Edit" OnClick="@context.Actions.StartEditingItemAsync" />
                    </CellTemplate>
                </TemplateColumn>
            </Columns>
        </MudDataGrid>

    </MudTabPanel>
    <MudTabPanel Text="IMTD">
        
    </MudTabPanel>

</MudTabs>

@code {
    private List<FinERP.Models.Salary> salaries = new();

    protected override void OnInitialized()
    {
        salaries.Add(new FinERP.Models.Salary { Id = 1, EmployeeName = "John Doe", Amount = 5000, Date = DateTime.Now });
        salaries.Add(new FinERP.Models.Salary { Id = 2, EmployeeName = "Jane Smith", Amount = 6000, Date = DateTime.Now });
    }

    private void AddNewRow()
    {
        // Simple logic to generate a new ID based on the highest existing ID
        var nextId = salaries.Any() ? salaries.Max(s => s.Id) + 1 : 1;

        // Insert a blank item at the top of the grid
        salaries.Insert(0, new FinERP.Models.Salary 
        { 
            Id = nextId,
            EmployeeName = "New Employee", 
            Amount = 0,
            Date = DateTime.Today
        });
    }
}